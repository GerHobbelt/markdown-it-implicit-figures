{"version":3,"file":"markdownItAbbr.umd.js","sources":["../index.js"],"sourcesContent":["\nexport default function implicitFiguresPlugin(md, options) {\n  options = options || {};\n\n  function implicitFigures(state) {\n    // reset tabIndex on md.render()\n    let tabIndex = 1;\n\n    // do not process first and last token\n    for (let i = 1, l = state.tokens.length; i < (l - 1); ++i) {\n      let token = state.tokens[i];\n\n      if (token.type !== 'inline') { continue; }\n      // children: image alone, or link_open -> image -> link_close\n      if (!token.children || (token.children.length !== 1 && token.children.length !== 3)) { continue; }\n      // one child, should be img\n      if (token.children.length === 1 && token.children[0].type !== 'image') { continue; }\n      // three children, should be image enclosed in link\n      if (token.children.length === 3 &&\n          (token.children[0].type !== 'link_open' ||\n           token.children[1].type !== 'image' ||\n           token.children[2].type !== 'link_close')) {\n        continue;\n      }\n      // prev token is paragraph open\n      if (i !== 0 && state.tokens[i - 1].type !== 'paragraph_open') { continue; }\n      // next token is paragraph close\n      if (i !== (l - 1) && state.tokens[i + 1].type !== 'paragraph_close') { continue; }\n\n      // We have inline token containing an image only.\n      // Previous token is paragraph open.\n      // Next token is paragraph close.\n      // Lets replace the paragraph tokens with figure tokens.\n      let figure = state.tokens[i - 1];\n      figure.type = 'figure_open';\n      figure.tag = 'figure';\n      state.tokens[i + 1].type = 'figure_close';\n      state.tokens[i + 1].tag = 'figure';\n\n      if (options.dataType === true) {\n        // if inside link, image/video is second child\n        figure = (token.children.length === 1) ? token.children[0] : token.children[1];\n        // Get data type\n        let src = figure.attrs.find(item => item[0] === 'src')[1];\n        let dataType = src.match(/(mp4|webm|ogg)$/) ? 'video' : 'image';\n        state.tokens[i - 1].attrPush([ 'data-type', dataType ]);\n      }\n      var image;\n\n      if (options.link === true && token.children.length === 1) {\n        image = token.children[0];\n        token.children.unshift(\n          new state.Token('link_open', 'a', 1)\n        );\n        token.children[0].attrPush([ 'href', image.attrGet('src') ]);\n        token.children.push(\n          new state.Token('link_close', 'a', -1)\n        );\n      }\n\n      // for linked images, image is one off\n      image = token.children.length === 1 ? token.children[0] : token.children[1];\n\n      if (options.figcaption === true) {\n        if (image.children && image.children.length) {\n          token.children.push(\n            new state.Token('figcaption_open', 'figcaption', 1)\n          );\n          token.children.splice(token.children.length, 0, ...image.children);\n          token.children.push(\n            new state.Token('figcaption_close', 'figcaption', -1)\n          );\n          image.children.length = 0;\n        }\n      }\n\n      if (options.copyAttrs && image.attrs) {\n        const f = options.copyAttrs === true ? '' : options.copyAttrs;\n        figure.attrs = image.attrs.filter(([ k, v ]) => k.match(f));\n      }\n\n      if (options.tabindex === true) {\n        // add a tabindex property\n        // you could use this with css-tricks.com/expanding-images-html5\n        state.tokens[i - 1].attrPush([ 'tabindex', tabIndex ]);\n        tabIndex++;\n      }\n    }\n  }\n  md.core.ruler.before('replacements', 'implicit_figures', implicitFigures);\n}\n"],"names":["implicitFiguresPlugin","md","options","implicitFigures","state","tabIndex","i","l","tokens","length","token","type","children","figure","tag","dataType","src","attrs","find","item","match","attrPush","image","link","unshift","Token","attrGet","push","figcaption","splice","copyAttrs","f","filter","k","v","tabindex","core","ruler","before"],"mappings":"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"}